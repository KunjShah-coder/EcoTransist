<%- include('partials/header') %>

<div class="container fade-in">
  <h1>Welcome, <%= user.name %>! ðŸŒ±</h1>
  
  <!-- Profile Summary Section -->
  <div class="stats">
    <p>Total Points: <strong><%= user.points %></strong></p>
    <p>COâ‚‚ Saved: <strong>
      <%= (typeof user.co2Saved === 'number' && !isNaN(user.co2Saved)) ? user.co2Saved.toFixed(2) : '0.00' %> kg
    </strong></p>    
    <p>Current Streak: <strong><%= user.streak || 0 %> days</strong></p>
  </div>

  <div class="feature-cards">
    <!-- Profile Card -->
    <div class="card">
      <h2>My Profile</h2>
      <div class="quick-stats">
        <p>Level: <%= user.level || 'Eco Starter' %></p>
        <p>Badges: <%= user.badges?.length || 0 %></p>
      </div>
      <a href="/profile" class="button">View Profile</a>
    </div>

    <!-- Travel Log Card -->
    <div class="card">
      <h2>Log Travel</h2>
      <p>Track your eco-friendly journeys</p>
      <a href="/travel" class="button">Log a Trip</a>
    </div>

    <!-- Rewards Card -->
    <div class="card">
      <h2>Rewards</h2>
      <p>Redeem your <%= user.points %> points</p>
      <a href="/rewards" class="button">View Rewards</a>
    </div>

    <!-- Daily Challenge Card -->
    <div class="card challenge-card">
      <h2>Daily Challenge</h2>
      <p class="challenge-text">Complete 3 trips today!</p>
      <div class="progress-bar">
        <div class="progress" style="width: <%= ((user.dailyTrips || 0) / 3) * 100 %>%"></div>
      </div>
      <p><%= user.dailyTrips || 0 %>/3 trips</p>
      <p class="bonus-text">Bonus: +50 points</p>
    </div>

    <!-- Streak Rewards -->
    <div class="card streak-card">
      <h2>Streak Rewards</h2>
      <div class="streak-info">
        <p>Current Streak: <%= user.streak || 0 %> days</p>
        <p>Weekly Streak: <%= Math.floor((user.streak || 0) / 7) %> weeks</p>
        <p>Next Reward: <%= 7 - ((user.streak || 0) % 7) %> days left</p>
      </div>
      <div class="streak-circles">
        <% for(let i = 1; i <= 7; i++) { %>
          <div class="streak-circle <%= i <= (user.streak % 7 || 7) ? 'active' : '' %>">
            <%= i %>
          </div>
        <% } %>
      </div>
    </div>
    <!-- Community Goals -->
    <div class="card">
      <h2>Community Goals</h2>
      <p>City-wide Challenge:</p>
      <p class="challenge-text">Reduce 1000kg COâ‚‚ this week!</p>
      <div class="progress-bar">
        <div class="progress" style="width: <%= ((user.communityCO2 || 0) / 1000) * 100 %>%"></div>
      </div>
      <p><%= user.communityCO2 || 0 %>/1000 kg</p>
    </div>

    <!-- Tree Planting Progress -->
    <div class="card">
      <h2>Tree Planting Progress</h2>
      <p>Points needed for next tree: <%= 500 - (user.points % 500) %></p>
      <div class="progress-bar">
        <div class="progress" style="width: <%= ((user.points % 500) / 500) * 100 %>%"></div>
      </div>
      <p>Trees planted: <%= Math.floor(user.points / 500) %></p>
    </div>
  </div>
</div>

<%- include('partials/footer') %>

